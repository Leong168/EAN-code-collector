<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR & Barcode Scanner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            text-align: center;
        }
        #reader {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
        }
        #result-container {
            margin-top: 20px;
            text-align: left;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <h1>Mobile Scanner App</h1>

    <button id="start-qr-btn">Scan QR Code</button>
    <button id="start-barcode-btn" style="display:none;">Scan Barcode 128</button>
    <button id="stop-btn" style="display:none;">Stop Scanning</button>
    <br><br>

    <div id="reader"></div>

    <div id="result-container">
        <h2>Scanned Data</h2>
        <p>Your data is auto-saved locally.</p>
        <button id="export-btn">Export to Excel</button>
        <table>
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Value</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody id="data-table-body">
            </tbody>
        </table>
    </div>

    <script>
        let html5QrCode;
        const dataKey = 'scannedData';
        let scannedData = JSON.parse(localStorage.getItem(dataKey)) || [];

        // Function to render the data table from the local storage
        function renderTable() {
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = '';
            scannedData.forEach(item => {
                const row = `<tr><td>${item.type}</td><td>${item.value}</td><td>${item.timestamp}</td></tr>`;
                tableBody.innerHTML += row;
            });
        }

        // Auto-save function
        function autoSave() {
            localStorage.setItem(dataKey, JSON.stringify(scannedData));
        }

        // Start QR Code scanning
        document.getElementById('start-qr-btn').addEventListener('click', () => {
            const qrboxFunction = function(viewfinderWidth, viewfinderHeight) {
                const minEdgePercentage = 0.7; // 70%
                const minEdgeSize = Math.min(viewfinderWidth, viewfinderHeight);
                const qrboxSize = Math.floor(minEdgeSize * minEdgePercentage);
                return { width: qrboxSize, height: qrboxSize };
            };
            const config = {
                fps: 10,
                qrbox: qrboxFunction,
                formatsToSupport: [Html5QrcodeSupportedFormats.QR_CODE]
            };
            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess, onScanError);
            document.getElementById('start-qr-btn').style.display = 'none';
            document.getElementById('start-barcode-btn').style.display = 'none';
            document.getElementById('stop-btn').style.display = 'inline';
        });

        // Start Barcode 128 scanning
        document.getElementById('start-barcode-btn').addEventListener('click', () => {
            const config = {
                fps: 10,
                formatsToSupport: [Html5QrcodeSupportedFormats.CODE_128]
            };
            html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess, onScanError);
            document.getElementById('start-qr-btn').style.display = 'none';
            document.getElementById('start-barcode-btn').style.display = 'none';
            document.getElementById('stop-btn').style.display = 'inline';
        });

        // Stop scanning
        document.getElementById('stop-btn').addEventListener('click', () => {
            if (html5QrCode) {
                html5QrCode.stop().then(() => {
                    console.log("Scanning stopped.");
                    document.getElementById('start-qr-btn').style.display = 'inline';
                    document.getElementById('start-barcode-btn').style.display = 'inline';
                    document.getElementById('stop-btn
